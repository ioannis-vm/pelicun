<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>%% &mdash; pelicun  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=f9bf6728" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/design-tabs.js?v=f930bc37"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1. Getting started" href="../../developer_guide/getting_started.html" />
    <link rel="prev" title="Example Index" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #F2F2F2" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/pelicun-Logo-grey.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/install.html">1. Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/install.html#staying-up-to-date">1.1. Staying up to date</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/pelicun_framework.html">2. The pelicun framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/pelicun_framework.html#abbreviations">2.1. Abbreviations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/pelicun_framework.html#glossary">2.2. Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/pelicun_framework.html#introduction-to-pelicun">2.3. Introduction to pelicun</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/pelicun_framework.html#overview">2.4. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/pelicun_framework.html#performance-assessment-workflow">2.5. Performance Assessment Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/pelicun_framework.html#response-model">2.6. Response Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/pelicun_framework.html#performance-model">2.7. Performance Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/pelicun_framework.html#damage-model">2.8. Damage Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/pelicun_framework.html#loss-model">2.9. Loss Model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/feature_overview.html">3. Overview of pelicun features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/damage_and_loss_library.html">4. Damage and loss library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/bug_reports_and_feature_requests.html">5. Bug reports and feature requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/resources_for_new_python_users.html">6. Resources for new python users</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Example Index</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#complete-list">Complete list</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#grouped-by-feature">Grouped by feature</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide/getting_started.html">1. Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/getting_started.html#code-of-conduct">1.1. Code of conduct</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/getting_started.html#how-to-contribute">1.2. How to contribute</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide/development_environment.html">2. Setting up a development environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide/code_quality.html">3. Coding practice</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/code_quality.html#code-quality-assurance">3.1. Code quality assurance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/code_quality.html#unit-tests">3.2. Unit tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/code_quality.html#documentation">3.3. Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide/internals.html">4. Package architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guide/internals.html#overview-of-files">4.1. Overview of files</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api_reference/_autosummary/pelicun.html">pelicun</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes/index.html">Release Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes/index.html#version-3-0">Version 3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes/index.html#version-2-0">Version 2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes/index.html#version-1-0">Version 1.0</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../other/license.html">Copyright and license</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../other/cite.html">Citing pelicun</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../other/cite.html#pelicun-logo">pelicun logo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../other/acknowledgments.html">Acknowledgments</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../other/acknowledgments.html#national-science-foundation">National Science Foundation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../other/acknowledgments.html#contributors">Contributors</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #F2F2F2" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pelicun</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Example Index</a></li>
      <li class="breadcrumb-item active">%%</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>“”” Example 1 “””</p>
<section id="%%">
<h1>%%<a class="headerlink" href="#%%" title="Link to this heading"></a></h1>
</section>
<section id="Imports">
<h1>Imports<a class="headerlink" href="#Imports" title="Link to this heading"></a></h1>
<p>from <strong>future</strong> import annotations import numpy as np import pandas as pd import pytest from pelicun.warnings import PelicunWarning from pelicun.base import convert_to_MultiIndex from pelicun.assessment import Assessment</p>
</section>
<section id="section-1">
<span id="id2"></span><h1>%%<a class="headerlink" href="#section-1" title="Link to this heading"></a></h1>
<p>sample_size = 20 raw_demands = pd.read_csv( ‘pelicun/tests/compatibility/PRJ-3411v5/demand_data.csv’, index_col=0 ) raw_demands = convert_to_MultiIndex(raw_demands, axis=0) raw_demands.index.names = [‘stripe’, ‘type’, ‘loc’, ‘dir’] stripe = ‘3’ stripe_demands = raw_demands.loc[stripe, :] stripe_demands.insert(0, ‘Units’, ‘’) stripe_demands.loc[‘PFA’, ‘Units’] = ‘g’ stripe_demands.loc[‘PID’, ‘Units’] = ‘rad’ stripe_demands.insert(1, ‘Family’, ‘’) stripe_demands[‘Family’] = ‘lognormal’
stripe_demands.rename(columns={‘median’: ‘Theta_0’}, inplace=True) stripe_demands.rename(columns={‘log_std’: ‘Theta_1’}, inplace=True) ndims = stripe_demands.shape[0] demand_types = stripe_demands.index perfect_CORR = pd.DataFrame( np.ones((ndims, ndims)), columns=demand_types, index=demand_types )</p>
<p>PAL = Assessment({‘PrintLog’: True, ‘Seed’: 415}) PAL.demand.load_model({‘marginals’: stripe_demands, ‘correlation’: perfect_CORR}) PAL.demand.generate_sample({‘SampleSize’: sample_size})</p>
<p>demand_sample = PAL.demand.save_sample()</p>
<p>from pelicun import file_io</p>
<p>file_io.save_to_csv( demand_sample, f’/tmp/demand_sample.csv’, units=demand_units, unit_conversion_factors=PAL.unit_conversion_factors, )</p>
<p>delta_y = 0.0075 PID = demand_sample[‘PID’] RID = PAL.demand.estimate_RID(PID, {‘yield_drift’: delta_y}) demand_sample_ext = pd.concat([demand_sample, RID], axis=1) Sa_vals = [0.158, 0.387, 0.615, 0.843, 1.071, 1.299, 1.528, 1.756] demand_sample_ext[(‘SA_1.13’, 0, 1)] = Sa_vals[int(stripe) - 1] demand_sample_ext.T.insert(0, ‘Units’, ‘’) demand_sample_ext.loc[‘Units’, [‘PFA’, ‘SA_1.13’]] = ‘g’ demand_sample_ext.loc[‘Units’, [‘PID’, ‘RID’]] = ‘rad’</p>
<p>PAL.demand.load_sample(demand_sample_ext)</p>
<p>cmp_marginals = pd.read_csv( ‘pelicun/tests/compatibility/PRJ-3411v5/CMP_marginals.csv’, index_col=0 )</p>
<p>PAL.stories = 4 PAL.asset.load_cmp_model({‘marginals’: cmp_marginals}) PAL.asset.generate_cmp_sample()</p>
<p>cmp_sample = PAL.asset.save_cmp_sample() assert cmp_sample is not None</p>
<p>with pytest.warns(PelicunWarning): P58_data = PAL.get_default_data(‘fragility_DB_FEMA_P58_2nd’)</p>
<p>cmp_list = cmp_marginals.index.unique().values[:-3] P58_data_for_this_assessment = P58_data.loc[cmp_list, :].sort_values( ‘Incomplete’, ascending=False ) additional_fragility_db = P58_data_for_this_assessment.sort_index()</p>
<p>P58_metadata = PAL.get_default_metadata(‘fragility_DB_FEMA_P58_2nd’) assert P58_metadata is not None</p>
<p>additional_fragility_db.loc[ [‘D.20.22.013a’, ‘D.20.22.023a’, ‘D.20.22.023b’], [(‘LS1’, ‘Theta_1’), (‘LS2’, ‘Theta_1’)],] = 0.5 additional_fragility_db.loc[‘D.20.31.013b’, (‘LS1’, ‘Theta_1’)] = 0.5 additional_fragility_db.loc[‘D.20.61.013b’, (‘LS1’, ‘Theta_1’)] = 0.5 additional_fragility_db.loc[‘D.30.31.013i’, (‘LS1’, ‘Theta_0’)] = 1.5 # g additional_fragility_db.loc[‘D.30.31.013i’, (‘LS1’, ‘Theta_1’)] = 0.5 additional_fragility_db.loc[‘D.30.31.023i’, (‘LS1’, ‘Theta_0’)] = 1.5 # g
additional_fragility_db.loc[‘D.30.31.023i’, (‘LS1’, ‘Theta_1’)] = 0.5 additional_fragility_db.loc[‘D.30.52.013i’, (‘LS1’, ‘Theta_0’)] = 1.5 # g additional_fragility_db.loc[‘D.30.52.013i’, (‘LS1’, ‘Theta_1’)] = 0.5 additional_fragility_db[‘Incomplete’] = 0</p>
<p>additional_fragility_db.loc[ ‘excessiveRID’, [ (‘Demand’, ‘Directional’), (‘Demand’, ‘Offset’), (‘Demand’, ‘Type’), (‘Demand’, ‘Unit’), ],] = [1, 0, ‘Residual Interstory Drift Ratio’, ‘rad’] additional_fragility_db.loc[ ‘excessiveRID’, [(‘LS1’, ‘Family’), (‘LS1’, ‘Theta_0’), (‘LS1’, ‘Theta_1’)]] = [‘lognormal’, 0.01, 0.3] additional_fragility_db.loc[ ‘irreparable’, [ (‘Demand’, ‘Directional’), (‘Demand’, ‘Offset’), (‘Demand’, ‘Type’), (‘Demand’, ‘Unit’), ],] = [1, 0, ‘Peak Spectral
Acceleration|1.13’, ‘g’] additional_fragility_db.loc[‘irreparable’, (‘LS1’, ‘Theta_0’)] = 1e10 additional_fragility_db.loc[ ‘collapse’, [ (‘Demand’, ‘Directional’), (‘Demand’, ‘Offset’), (‘Demand’, ‘Type’), (‘Demand’, ‘Unit’), ],] = [1, 0, ‘Peak Spectral Acceleration|1.13’, ‘g’] additional_fragility_db.loc[ ‘collapse’, [(‘LS1’, ‘Family’), (‘LS1’, ‘Theta_0’), (‘LS1’, ‘Theta_1’)]] = [‘lognormal’, 1.35, 0.5] additional_fragility_db[‘Incomplete’] = 0</p>
<p>with pytest.warns(PelicunWarning): PAL.damage.load_damage_model( [additional_fragility_db, ‘PelicunDefault/fragility_DB_FEMA_P58_2nd.csv’] )</p>
</section>
<section id="FEMA-P58-uses-the-following-process:">
<h1>FEMA P58 uses the following process:<a class="headerlink" href="#FEMA-P58-uses-the-following-process:" title="Link to this heading"></a></h1>
<p>dmg_process = { ‘1_collapse’: {‘DS1’: ‘ALL_NA’}, ‘2_excessiveRID’: {‘DS1’: ‘irreparable_DS1’}, } PAL.damage.calculate(dmg_process=dmg_process)</p>
<p>damage_sample = PAL.damage.save_sample() assert damage_sample is not None</p>
<p>drivers = [f’DMG-{cmp}’ for cmp in cmp_marginals.index.unique()] drivers = drivers[:-3] + drivers[-2:]</p>
<p>loss_models = cmp_marginals.index.unique().tolist()[:-3] loss_models += [‘replacement’] * 2 loss_map = pd.DataFrame(loss_models, columns=[‘BldgRepair’], index=drivers)</p>
<p>with pytest.warns(PelicunWarning): P58_data = PAL.get_default_data(‘bldg_repair_DB_FEMA_P58_2nd’)</p>
<p>P58_data_for_this_assessment = P58_data.loc[loss_map[‘BldgRepair’].values[:-2], :]</p>
<p>additional_consequences = pd.DataFrame( columns=pd.MultiIndex.from_tuples( [ (‘Incomplete’, ‘’), (‘Quantity’, ‘Unit’), (‘DV’, ‘Unit’), (‘DS1’, ‘Theta_0’), ] ), index=pd.MultiIndex.from_tuples( [(‘replacement’, ‘Cost’), (‘replacement’, ‘Time’)] ), ) additional_consequences.loc[(‘replacement’, ‘Cost’)] = [ 0, ‘1 EA’, ‘USD_2011’, 21600000,] additional_consequences.loc[(‘replacement’, ‘Time’)] = [ 0, ‘1 EA’, ‘worker_day’, 12500,]</p>
<p>with pytest.warns(PelicunWarning): PAL.bldg_repair.load_model( [ additional_consequences, ‘PelicunDefault/bldg_repair_DB_FEMA_P58_2nd.csv’, ], loss_map, )</p>
<p>PAL.bldg_repair.calculate()</p>
<p>loss_sample = PAL.bldg_repair.sample assert loss_sample is not None</p>
<p>with pytest.warns(PelicunWarning): agg_DF = PAL.bldg_repair.aggregate_losses() assert agg_DF is not None</p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Leland Stanford Junior University and The Regents of the University of California.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-158130480-7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-158130480-7', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>